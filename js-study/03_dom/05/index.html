<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <header>
            <h1>게시판</h1>
        </header>
        <!-- 게시물 목록 -->
        <div id="postListContainer" class="page-container active">
            <h2>전체 게시물</h2>
            <ul id="postList" class="list-container">
            </ul>

            <div id="pagination" class="pagination"></div>
        </div>
        <!-- 상세 페이지 -->
        <div id="postDetailContainer" class="page-container">
            <h2 id="detailTitle"></h2>
            <p>
                게시글ID: <span id="detailId"></span>
                작성자: <span id="detailUserId"></span>
            </p>
            <p id="detailBody">sdfsf</p>
            <button id="backBtn">목록으로</button>
        </div>
    </div>

</body>
<script>
    // 필요한 태그들 가져오기
    const postListContainer = document.querySelector("#postListContainer");
    const postList = document.querySelector("#postList");
    const pagination = document.querySelector("#pagination")

    // 상세페이지
    const postDetailContainer = document.querySelector("#postDetailConainer");
    const detailTitle = document.querySelector("#detailTitle");
    const detailId = document.querySelector("#detailId");
    const detailUserId = document.querySelector("#detailUserId");
    const detailBody = document.querySelector("#detailBody");
    const backBtn = document.querySelector("#backBtn");

    // 전역변수
    let currentPage = 1; // 바뀜
    let totalPage = 1; // 바뀜
    const pageSize = 10;
    const BASE_URL = "https://gorest.co.in/public/v2/posts";

    // 페이지 번호를 매개변수로 받아서 게시글 요청
    const loadPosts = async (page) => {
        postList.innerHTML = "<li>불러오는 중...</li>";

        const url = `${BASE_URL}?page=${page}&per_page=${pageSize}`;
        // resolve 결과를 response에 담는다
        // 완료될떄까지 대기
        const response = await fetch(url);
        const posts = await response.json();
        
        // 전체 페이지 수가 응답헤더에 담겨있을 수 있음
        let pageCount =  response.headers.get("X-Pagination-pages");
        pageCount = parseInt(pageCount);
        totalPage = pageCount; // 전역변수 덮어쓰기

        // post를 랜더링 -> 매개변수로 posts를 넘겨줄것임
        renderPostList(posts);
        // 페이지네이션 렌더링
        renderPagination();
    }

    const renderPostList = (posts) => {
        let myHtml = "";
        for(let post of posts) {
            // data-id 속성
            // html에 데이터를 숨겨서 저장할 수 있는속성
            // js에서 요소.dataset 으로 접근가능
            // data-{id} -> 요소.dataset.id
            // data-{qwer} -> 요소.dataset.qwer
            myHtml += `
                <li>
                    <span class="post-title" data-id="${post.id}">
                        ${post.title}    
                    </span>
                    <button class="detail-btn" data-id="${post.id}">
                        상세보기    
                    </button>
                </li>
            
            `
        }

        postList.innerHTML = myHtml
    }

    // 페이지네이션 렌더링
    const renderPagination = () => {
        let myHtml = "";
        // 현재페이지가 7페이지라면
        // [처음] [이전] [5] [6] [7] [8] [9] [다음] [끝]
        
        // 처음버튼
        myHtml += `
            <button            
                data-page="1"
                ${
                    // 현재페이지가 1페이지면 비활성화
                    currentPage === 1
                    ? "disabled"
                    :""
                }
            >
                처음    
            </button>
        
        `;

        // 이전버튼
         myHtml += `
            <button            
                data-page="${currentPage - 1}"
                ${
                    // 현재페이지가 1페이지면 비활성화
                    currentPage === 1
                    ? "disabled"
                    :""
                }
            >
                이전  
            </button>
            `;

            // 시작 / 끝 페이지 계산
            let startPage = currentPage - 2;
            let endPage = currentPage + 2;

            // 보정
            if (startPage < 1) {
                startPage = 1;
            }

            if(endPage >totalPage) {
                // 현재페이지가 100페이지
                // 102페이지까지 렌더링됨
                // 근데 최대페이지가 101페이지면, 102페이지는 잘못렌더링
                endPage = totalPage; // 보정
            }

            // 페이지 번호 출력
            for(let page = startPage; page <= endPage; page++) {
                // 현재페이지는 클릭이 안되게 막음
                if (page === currentPage) {
                    myHtml += `<button disabled>${page}</button>`;
                } else {
                    myHtml += `<button data-page=${page}>${page}</button>`;
                }
            }

            // 다음 페이지 버튼(현재페이지가 끝이면 비활성화)
            myHtml += `
                <button
                    data-page="${currentPage + 1}"
                    ${
                        currentPage === totalPage
                        ? "disabled"
                        : ""
                    
                    }
                >
                    다음
                    
                    
                    
                    </button>
            
            
            `;

            // 마지막 페이지 버튼
            myHtml += `
                <button
                    data-page=${totalPage}
                    ${
                        // 현재 페이지가 끝페이지면 비히ㅘㄹ성화
                        currentPage === totalPage
                                ? "disabled"
                                :""

                    
                    
                    }
                >
                    끝

                    </button>
            
            `;

            pagination.innerHTML = myHtml;

    }

    pagination.addEventListener("click", (e) => {
        const target = e.target;  
        // data-page에 담아둔것 꺼내봅시다
        // HTML 태그에 data-{dsfsa}로 담으면
        // 요소.data.dsfsa
        let page = target.dataset.page;
        page = parseInt(page); // 형변환
        
        if(page < 1 || page > totalPage) {
            return;
        }

        // 현재페이지
        currentPage = page; // 전액변수 수정
        loadPosts(currentPage); // 재랜더링
    })
    loadPosts(1);
</script>
</html>